{
  "kind": "build_request",
  "title": "Fix admin authentication validation for product creation operations",
  "projectName": "Mosslight Studios",
  "priority": "high",
  "requirements": [
    {
      "id": "REQ-88",
      "text": "Update the backend addProduct method in main.mo to properly validate admin authentication by checking the admin authorization state before processing product creation requests",
      "target": "backend",
      "source": {
        "messageIds": [
          "msg-latest"
        ],
        "quotes": [
          "i logged in to the admin portal , im adding a product and when i went to hit add product it gave me that error",
          "it says i dont have permission to preform this action but im logged in to the admin page"
        ]
      },
      "acceptanceCriteria": [
        "Admin users authenticated with the correct passcode (09131991) can successfully add products without permission errors",
        "The backend addProduct method validates admin session/authorization before rejecting requests",
        "Non-admin users continue to receive permission denied errors when attempting to add products"
      ]
    },
    {
      "id": "REQ-89",
      "text": "Verify that the useProducts hook addProduct mutation correctly passes admin authentication credentials or session tokens to the backend actor when invoking the addProduct method",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-latest"
        ],
        "quotes": [
          "im able to see the admin dashboard after logging in it shows up as soon as i click add product"
        ]
      },
      "acceptanceCriteria": [
        "The addProduct mutation includes necessary authentication headers or context when calling the backend",
        "Frontend successfully transmits admin session information established during passcode login to backend product operations",
        "Console logs confirm authentication data is being sent with the addProduct request"
      ]
    },
    {
      "id": "REQ-90",
      "text": "Ensure the AdminAuthProvider context state is accessible to the useProducts hook and ProductForm component so that admin authentication status can be verified before attempting product operations",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-latest"
        ],
        "quotes": [
          "im able to see the admin dashboard after logging in"
        ]
      },
      "acceptanceCriteria": [
        "ProductForm component and useProducts hook have access to admin authentication state from AdminAuthProvider",
        "Admin authentication status is verified in the UI before enabling product creation actions",
        "Error messages differentiate between authentication failures and other product creation errors"
      ]
    },
    {
      "id": "REQ-91",
      "text": "Add detailed error logging to both frontend (useProducts hook) and backend (addProduct method) to capture the exact point of failure when permission errors occur during product creation",
      "target": "both",
      "source": {
        "messageIds": [
          "msg-latest"
        ],
        "quotes": [
          "I tried to add a product with no variants and its still saying failed to add product"
        ]
      },
      "acceptanceCriteria": [
        "Frontend console logs show authentication state, request payload, and backend response when addProduct fails",
        "Backend logs capture authentication validation results and the specific authorization check that is failing",
        "Error messages in the UI indicate whether the failure is due to authentication, authorization, validation, or other issues"
      ]
    }
  ],
  "constraints": [
    "Maintain the existing 8-digit passcode authentication system (09131991) for admin access",
    "Do not modify the AdminAuthProvider implementation unless necessary to fix the authentication flow",
    "Preserve the single-actor backend architecture with all logic in main.mo",
    "Keep the existing admin dashboard routing and navigation structure intact"
  ],
  "nonGoals": [
    "Implementing a new authentication system or replacing the passcode mechanism",
    "Adding new admin features or capabilities beyond fixing the permission issue",
    "Modifying product variant validation or pricing logic",
    "Changing the UI/UX of the ProductForm component"
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  }
}