{
  "kind": "build_request",
  "title": "Fix admin authentication issue preventing product creation",
  "projectName": "Mosslight Studios",
  "priority": "high",
  "requirements": [
    {
      "id": "REQ-97",
      "text": "Update the backend addProduct method in main.mo to correctly validate admin authentication by verifying the caller's principal against the admin authorization state, allowing authenticated admin users logged in with passcode 09131991 to successfully create products",
      "target": "backend",
      "source": {
        "messageIds": [
          "msg-final"
        ],
        "quotes": [
          "fix it",
          "failed to add product",
          "permission validation failure in backend"
        ]
      },
      "acceptanceCriteria": [
        "Admin users logged in through AdminAuthProvider with correct passcode can successfully add products",
        "The addProduct method validates admin status by checking caller principal against stored admin authorization",
        "Product creation succeeds for both products with variants and products without variants",
        "Error messages clearly indicate authentication issues if admin is not properly authenticated"
      ]
    },
    {
      "id": "REQ-98",
      "text": "Add comprehensive error logging to the backend addProduct method that logs the caller principal, admin authorization check result, and specific validation failure points to help diagnose authentication issues",
      "target": "backend",
      "source": {
        "messageIds": [
          "msg-final"
        ],
        "quotes": [
          "Add detailed error logging to both frontend (useProducts hook) and backend (addProduct method)"
        ]
      },
      "acceptanceCriteria": [
        "Backend logs the caller principal when addProduct is invoked",
        "Backend logs whether the caller is authorized as admin",
        "Backend logs specific validation failure reasons (authentication, permissions, data validation)",
        "Error logs include timestamps and context for debugging"
      ]
    },
    {
      "id": "REQ-99",
      "text": "Verify that the frontend useProducts hook addProduct mutation correctly passes the authenticated caller's identity to the backend actor when invoking the addProduct method",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-final"
        ],
        "quotes": [
          "Verify that the useProducts hook addProduct mutation correctly passes admin authentication credentials to the backend actor"
        ]
      },
      "acceptanceCriteria": [
        "The useProducts hook uses the authenticated actor instance from useActor hook",
        "The addProduct mutation invokes backend.addProduct with the caller's authenticated identity",
        "Frontend logs confirm the authenticated actor is being used for product creation",
        "Identity delegation is valid and not expired when making backend calls"
      ]
    }
  ],
  "constraints": [
    "Maintain the existing admin passcode authentication system (09131991)",
    "Do not modify the AdminAuthProvider or Internet Identity integration",
    "Keep all Motoko logic in the main actor file (backend/main.mo)",
    "Preserve the existing product data model and variant structure"
  ],
  "nonGoals": [
    "Changing the admin authentication passcode",
    "Modifying the frontend ProductForm UI or validation logic",
    "Altering the product variant data structure",
    "Adding new authentication methods beyond Internet Identity and passcode"
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  }
}